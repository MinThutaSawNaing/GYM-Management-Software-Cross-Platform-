<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gym Management System</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"
    />
    <style>
      :root {
        --primary-dark: #343a40;
        --primary-darker: #23272b;
        --bottom-nav-height: 70px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background-color: #f8f9fa;
        padding-bottom: var(--bottom-nav-height);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, sans-serif;
      }

      /* Desktop Navigation */
      .desktop-nav {
        background-color: var(--primary-dark);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      /* Mobile Top Bar */
      .mobile-top-bar {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: var(--primary-dark);
        z-index: 1030;
        align-items: center;
        padding: 0 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .mobile-top-bar-title {
        color: white;
        font-size: 1.1rem;
        font-weight: 600;
      }

      /* Bottom Navigation */
      .bottom-nav {
        display: none;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: var(--bottom-nav-height);
        background: white;
        border-top: 1px solid #dee2e6;
        z-index: 1030;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      }

      .bottom-nav-items {
        display: flex;
        height: 100%;
      }

      .bottom-nav-item {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #6c757d;
        text-decoration: none;
        transition: all 0.3s ease;
        position: relative;
      }

      .bottom-nav-item.active {
        color: #007bff;
      }

      .bottom-nav-item:hover {
        background: rgba(0, 123, 255, 0.05);
      }

      .bottom-nav-item i {
        font-size: 1.3rem;
        margin-bottom: 4px;
      }

      .bottom-nav-item span {
        font-size: 0.7rem;
        font-weight: 500;
      }

      .bottom-nav-badge {
        position: absolute;
        top: 8px;
        right: 20%;
        background: #dc3545;
        color: white;
        font-size: 0.6rem;
        padding: 2px 5px;
        border-radius: 10px;
        min-width: 18px;
        text-align: center;
      }

      /* Main Content */
      .main-content {
        padding-top: 70px;
        min-height: 100vh;
      }

      /* Cards */
      .card {
        margin-bottom: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border: none;
        border-radius: 12px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
      }

      .card-header {
        background-color: var(--primary-dark);
        color: white;
        border-radius: 12px 12px 0 0 !important;
        padding: 15px 20px;
        font-weight: 600;
      }

      /* Buttons */
      .btn-primary {
        background-color: var(--primary-dark);
        border-color: var(--primary-dark);
        border-radius: 8px;
        padding: 10px 20px;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        background-color: var(--primary-darker);
        border-color: var(--primary-darker);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      .custom-admin-btn {
        min-width: 70px; /* Increased to fit text */
        padding: 0.25rem 0.5rem;
        margin: 0 2px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.25rem; /* Space between icon and text */
      }

      /* Ensure the icon and text are properly aligned */
      .custom-admin-btn i {
        font-size: 0.9em;
      }

      /* Tables */
      .table-responsive {
        border-radius: 8px;
        overflow: hidden;
      }

      .table {
        margin-bottom: 0;
      }

      .table th {
        background: #f8f9fa;
        font-weight: 600;
        border-bottom: 2px solid #dee2e6;
      }

      /* Tabs */
      .nav-tabs {
        border-bottom: 2px solid #dee2e6;
        margin-bottom: 20px;
      }

      .nav-tabs .nav-link {
        border: none;
        color: #6c757d;
        font-weight: 500;
        padding: 12px 20px;
        border-radius: 8px 8px 0 0;
        transition: all 0.3s ease;
      }

      .nav-tabs .nav-link:hover {
        background: rgba(0, 0, 0, 0.05);
      }

      .nav-tabs .nav-link.active {
        background-color: var(--primary-dark);
        color: white;
        border-color: var(--primary-dark);
      }

      /* QR Scanner */
      .qr-scanner {
        width: 100%;
        max-width: 500px;
        margin: 0 auto;
        border-radius: 12px;
        overflow: hidden;
      }

      /* Messages */
      .message-sent,
      .message-received {
        padding: 12px 16px;
        border-radius: 18px;
        margin-bottom: 10px;
        max-width: 80%;
      }

      .message-sent {
        background-color: #e9ecef;
        text-align: right;
        margin-left: auto;
      }

      .message-received {
        background-color: #d1ecf1;
        margin-right: auto;
      }

      /* Status Indicators */
      .check-status,
      .subscription-status {
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .checked-in {
        background-color: #d4edda;
        color: #155724;
      }

      .checked-out {
        background-color: #f8d7da;
        color: #721c24;
      }

      .active-subscription {
        background-color: #d4edda;
        color: #155724;
      }

      .pending-subscription {
        background-color: #fff3cd;
        color: #856404;
      }

      .expired-subscription {
        background-color: #f8d7da;
        color: #721c24;
      }

      .no-subscription {
        background-color: #f8d7da;
        color: #721c24;
      }
      .btn-group {
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 5px; /* space between buttons */
      }

      .btn-group .btn {
        flex: none; /* prevent weird shrinking */
      }

      /* Mobile Specific */
      @media (max-width: 768px) {
        .desktop-nav {
          display: none;
        }

        .mobile-top-bar {
          display: flex;
        }

        .bottom-nav {
          display: block;
        }

        .main-content {
          padding-top: 60px;
        }

        .container {
          padding: 0 15px;
        }

        .card {
          margin-bottom: 15px;
        }

        .nav-tabs {
          flex-wrap: nowrap;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }

        .nav-tabs .nav-link {
          white-space: nowrap;
          padding: 10px 15px;
          font-size: 0.9rem;
        }

        .table {
          font-size: 0.9rem;
        }

        .btn {
          font-size: 0.9rem;
          padding: 8px 16px;
        }

        .modal-dialog {
          margin: 10px;
        }

        .check-in-out-btn {
          font-size: 16px;
          padding: 12px;
        }
      }

      /* Animations */
      @keyframes slideIn {
        from {
          transform: translateX(-100%);
        }
        to {
          transform: translateX(0);
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* Refresh Button */
      .refresh-btn {
        position: fixed;
        bottom: 90px;
        right: 20px;
        z-index: 1020;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
      }

      .refresh-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      ::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      /* Section visibility */
      .content-section {
        display: none;
      }

      .content-section.active {
        display: block;
      }
    </style>
  </head>
  <body>
    <!-- Desktop Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark desktop-nav">
      <div class="container">
        <a class="navbar-brand" href="#">
          <i class="bi bi-activity"></i> Gym Management System
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="bi bi-person-circle"></i> {{ user.username }}
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item" href="/logout"
                    ><i class="bi bi-box-arrow-right"></i> Logout</a
                  >
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Mobile Top Bar -->
    <div class="mobile-top-bar">
      <span class="mobile-top-bar-title" id="mobileTopBarTitle"
        >Gym Management</span
      >
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <div class="bottom-nav-items">
        {% if role == 'admin' %}
        <a
          href="#dashboard"
          class="bottom-nav-item active"
          data-tab="dashboard"
        >
          <i class="bi bi-speedometer2"></i>
          <span>Dashboard</span>
        </a>
        <a href="#users" class="bottom-nav-item" data-tab="users">
          <i class="bi bi-people"></i>
          <span>Users</span>
        </a>
        <a href="#checkedin" class="bottom-nav-item" data-tab="checkedin">
          <i class="bi bi-people-fill"></i>
          <span>Check-ins</span>
        </a>
        <a href="#attendance" class="bottom-nav-item" data-tab="attendance">
          <i class="bi bi-calendar-check"></i>
          <span>Attendance</span>
        </a>
        <a href="#messages" class="bottom-nav-item" data-tab="messages">
          <i class="bi bi-envelope"></i>
          <span>Messages</span>
          {% if all_messages|selectattr('reply', 'equalto', None)|list|length >
          0 %}
          <span class="bottom-nav-badge"
            >{{ all_messages|selectattr('reply', 'equalto', None)|list|length
            }}</span
          >
          {% endif %}
        </a>
        <a href="#settings" class="bottom-nav-item" data-tab="settings">
          <i class="bi bi-gear"></i>
          <span>Settings</span>
        </a>
        {% else %}
        <a
          href="#announcements"
          class="bottom-nav-item active"
          data-tab="announcements"
        >
          <i class="bi bi-megaphone"></i>
          <span>Home</span>
        </a>
        <a href="#checkin" class="bottom-nav-item" data-tab="checkin">
          <i class="bi bi-qr-code-scan"></i>
          <span>Check-in</span>
        </a>
        <a href="#messages" class="bottom-nav-item" data-tab="messages">
          <i class="bi bi-envelope"></i>
          <span>Messages</span>
        </a>
        <a href="#subscription" class="bottom-nav-item" data-tab="subscription">
          <i class="bi bi-credit-card"></i>
          <span>Subscriptions</span>
        </a>
        <a href="#settings" class="bottom-nav-item" data-tab="settings">
          <i class="bi bi-gear"></i>
          <span>Settings</span>
        </a>
        {% endif %}
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="container mt-4">
        <!-- Admin Dashboard -->
        {% if role == 'admin' %}
        <div class="row">
          <div class="col-12">
            <ul
              class="nav nav-tabs d-none d-md-flex"
              id="adminTabs"
              role="tablist"
            >
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link active"
                  id="dashboard-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#dashboard"
                  type="button"
                  role="tab"
                >
                  <i class="bi bi-speedometer2"></i> Dashboard
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  id="attendance-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#attendance"
                  type="button"
                  role="tab"
                >
                  <i class="bi bi-calendar-check"></i> Attendance
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  id="users-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#users"
                  type="button"
                  role="tab"
                >
                  <i class="bi bi-people"></i> Users
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  id="subscriptions-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#subscriptions"
                  type="button"
                  role="tab"
                >
                  <i class="bi bi-credit-card"></i> Subscriptions
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  id="pricing-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#pricing"
                  type="button"
                  role="tab"
                >
                  <i class="bi bi-tag"></i> Pricing
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  id="messages-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#messages"
                  type="button"
                  role="tab"
                >
                  <i class="bi bi-envelope"></i> Messages
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  id="blogs-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#blogs"
                  type="button"
                  role="tab"
                >
                  <i class="bi bi-journal-text"></i> Blogs
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  id="qr-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#qr"
                  type="button"
                  role="tab"
                >
                  <i class="bi bi-qr-code"></i> QR Codes
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  id="checkedin-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#checkedin"
                  type="button"
                  role="tab"
                >
                  <i class="bi bi-people-fill"></i> Checked-in Users
                </button>
              </li>
            </ul>
            <div class="tab-content" id="adminTabsContent">
              <!-- Dashboard Tab -->
              <div
                class="tab-pane fade show active content-section"
                id="dashboard"
                role="tabpanel"
              >
                <div class="row g-3">
                  <div class="col-6 col-md-3">
                    <div class="card text-center h-100">
                      <div
                        class="card-body d-flex flex-column justify-content-center"
                      >
                        <i
                          class="bi bi-people text-primary mb-2"
                          style="font-size: 2rem"
                        ></i>
                        <h5 class="card-title">Total Users</h5>
                        <h2 class="text-primary">{{ users|length }}</h2>
                      </div>
                    </div>
                  </div>
                  <div class="col-6 col-md-3">
                    <div class="card text-center h-100">
                      <div
                        class="card-body d-flex flex-column justify-content-center"
                      >
                        <i
                          class="bi bi-credit-card text-warning mb-2"
                          style="font-size: 2rem"
                        ></i>
                        <h5 class="card-title">Active</h5>
                        <h2 class="text-warning">
                          {{ active_subscriptions|length }}
                        </h2>
                      </div>
                    </div>
                  </div>
                  <div class="col-6 col-md-3">
                    <div class="card text-center h-100">
                      <div
                        class="card-body d-flex flex-column justify-content-center"
                      >
                        <i
                          class="bi bi-envelope text-info mb-2"
                          style="font-size: 2rem"
                        ></i>
                        <h5 class="card-title">Unread</h5>
                        <h2 class="text-info">
                          {{ all_messages|selectattr('reply', 'equalto',
                          None)|list|length }}
                        </h2>
                      </div>
                    </div>
                  </div>
                  <div class="col-6 col-md-3">
                    <div class="card text-center h-100">
                      <div
                        class="card-body d-flex flex-column justify-content-center"
                      >
                        <i
                          class="bi bi-journal-text text-success mb-2"
                          style="font-size: 2rem"
                        ></i>
                        <h5 class="card-title">Blogs</h5>
                        <h2 class="text-success">{{ all_blogs|length }}</h2>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Users Tab -->
              <div
                class="tab-pane fade content-section"
                id="users"
                role="tabpanel"
              >
                <div
                  class="d-flex justify-content-between align-items-center mb-3"
                >
                  <h3 class="h4">User Management</h3>
                  <button
                    class="btn btn-primary"
                    data-bs-toggle="modal"
                    data-bs-target="#createUserModal"
                  >
                    <i class="bi bi-plus-circle"></i> Add User
                  </button>
                </div>
                <div class="table-responsive">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for user in users %}
                      <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.role }}</td>
                        <td>
                          {% if user.approved == 0 %}
                          <span class="badge bg-success">Active</span>
                          {% else %}
                          <span class="badge bg-danger">Banned</span>
                          {% endif %}
                        </td>
                        <td>
                          <div class="btn-group" role="group">
                            <button
                              class="btn btn-sm btn-outline-primary btn-edit-user"
                              data-user-id="{{ user.id }}"
                              data-username="{{ user.username }}"
                              data-email="{{ user.email }}"
                              data-role="{{ user.role }}"
                              data-approved="{{ user.approved }}"
                            >
                              <i class="bi bi-pencil"></i>
                            </button>
                            <button
                              class="btn btn-sm btn-{{ 'warning' if user.approved == 0 else 'secondary' }} btn-toggle-ban custom-admin-btn"
                              data-user-id="{{ user.id }}"
                              data-user-username="{{ user.username }}"
                            >
                              <i
                                class="bi bi-{{ 'ban' if user.approved == 0 else 'check-circle' }}"
                              ></i>
                              {{ 'Ban' if user.approved == 0 else 'Unban' }}
                            </button>
                            <button
                              class="btn btn-sm btn-outline-danger btn-delete-user"
                              data-user-id="{{ user.id }}"
                            >
                              <i class="bi bi-trash"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Subscriptions Tab -->
              <div
                class="tab-pane fade content-section"
                id="subscriptions"
                role="tabpanel"
              >
                <div
                  class="d-flex justify-content-between align-items-center mb-3"
                >
                  <h3 class="h4">Subscription Management</h3>
                  <button
                    class="btn btn-primary"
                    data-bs-toggle="modal"
                    data-bs-target="#createSubscriptionModal"
                  >
                    <i class="bi bi-plus-circle"></i> Add Subscription
                  </button>
                </div>
                <div class="table-responsive">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Type</th>
                        <th>Details</th>
                        <th>Price</th>
                        <th>Activated Date</th>
                        <th>Expire Date</th>
                        <th>Status</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for sub in active_subscriptions %}
                      <tr>
                        <td>{{ sub.id }}</td>
                        <td>{{ sub.username }}</td>
                        <td>
                          <span class="badge bg-primary">Monthly</span>
                        </td>
                        <td>{{ sub.months }} month(s)</td>
                        <td>{{ sub.price }} MMK</td>
                        <td>{{ sub.activated_at }}</td>
                        <td>{{ sub.expires_at or '-' }}</td>
                        <td>
                          <span class="badge bg-success">Active</span>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Pricing Tab -->
              <div
                class="tab-pane fade content-section"
                id="pricing"
                role="tabpanel"
              >
                <h3 class="h4 mb-3">Pricing Management</h3>

                <!-- Monthly Subscription Pricing -->
                <div class="card mb-4">
                  <div class="card-header">
                    <i class="bi bi-calendar-month"></i> Monthly Subscription
                    Price
                  </div>
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-md-6">
                        <p class="mb-0">Current monthly subscription price:</p>
                        <h4>{{ monthly_price }} MMK</h4>
                      </div>
                      <div class="col-md-6">
                        <div class="input-group">
                          <input
                            type="number"
                            class="form-control"
                            id="newMonthlyPrice"
                            placeholder="Enter new price"
                            value="{{ monthly_price }}"
                          />
                          <span class="input-group-text">MMK</span>
                          <button
                            class="btn btn-primary"
                            id="updateMonthlyPriceBtn"
                          >
                            Update
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Messages Tab -->
              <div
                class="tab-pane fade content-section"
                id="messages"
                role="tabpanel"
              >
                <h3 class="h4 mb-3">Messages</h3>
                <div class="accordion" id="messagesAccordion">
                  {% for message in all_messages %}
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="message{{ message.id }}">
                      <button
                        class="accordion-button collapsed"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#collapseMessage{{ message.id }}"
                      >
                        <div class="d-flex justify-content-between w-100">
                          <span
                            >{{ message.subject }} - {{ message.username
                            }}</span
                          >
                          {% if not message.reply %}
                          <span class="badge bg-primary">New</span>
                          {% endif %}
                        </div>
                      </button>
                    </h2>
                    <div
                      id="collapseMessage{{ message.id }}"
                      class="accordion-collapse collapse"
                      data-bs-parent="#messagesAccordion"
                    >
                      <div class="accordion-body">
                        <p><strong>From:</strong> {{ message.username }}</p>
                        <p><strong>Date:</strong> {{ message.created_at }}</p>
                        <p><strong>Message:</strong> {{ message.message }}</p>

                        {% if message.reply %}
                        <div class="card mt-3">
                          <div class="card-header">Reply</div>
                          <div class="card-body">
                            <p>{{ message.reply }}</p>
                            <p>
                              <small class="text-muted"
                                >Replied at: {{ message.replied_at }}</small
                              >
                            </p>
                          </div>
                        </div>
                        {% else %}
                        <div class="mt-3">
                          <textarea
                            class="form-control reply-text"
                            id="replyText{{ message.id }}"
                            rows="3"
                            placeholder="Type your reply..."
                          ></textarea>
                          <button
                            class="btn btn-primary mt-2 btn-reply-message"
                            data-message-id="{{ message.id }}"
                          >
                            <i class="bi bi-send"></i> Send Reply
                          </button>
                        </div>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                </div>
              </div>

              <!-- Blogs Tab -->
              <div
                class="tab-pane fade content-section"
                id="blogs"
                role="tabpanel"
              >
                <div
                  class="d-flex justify-content-between align-items-center mb-3"
                >
                  <h3 class="h4">Blog Management</h3>
                  <button
                    class="btn btn-primary"
                    data-bs-toggle="modal"
                    data-bs-target="#createBlogModal"
                  >
                    <i class="bi bi-plus-circle"></i> Add Blog
                  </button>
                </div>
                <div class="table-responsive">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th>Image</th>
                        <th>Title</th>
                        <th>Author</th>
                        <th>Created At</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for blog in all_blogs %}
                      <tr>
                        <td>
                          {% if blog.image_path %}
                          <img
                            src="{{ url_for('static', filename=blog.image_path.replace('static/', '')) }}"
                            alt="{{ blog.title }}"
                            style="width: 80px; height: 60px; object-fit: cover"
                          />
                          {% else %}
                          <span class="text-muted">No image</span>
                          {% endif %}
                        </td>
                        <td>{{ blog.title }}</td>
                        <td>{{ blog.username }}</td>
                        <td>{{ blog.created_at }}</td>
                        <td>
                          <div class="btn-group" role="group">
                            <button
                              class="btn btn-sm btn-outline-primary btn-edit-blog"
                              data-blog-id="{{ blog.id }}"
                              data-title="{{ blog.title }}"
                              data-content="{{ blog.content }}"
                              data-image-path="{{ blog.image_path or '' }}"
                            >
                              <i class="bi bi-pencil"></i>
                            </button>
                            <button
                              class="btn btn-sm btn-outline-danger btn-delete-blog"
                              data-blog-id="{{ blog.id }}"
                            >
                              <i class="bi bi-trash"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- QR Codes Tab -->
              <div
                class="tab-pane fade content-section"
                id="qr"
                role="tabpanel"
              >
                <div
                  class="d-flex justify-content-between align-items-center mb-3"
                >
                  <h3 class="h4">QR Code Management</h3>
                  <button class="btn btn-primary" id="generateNewQrBtn">
                    <i class="bi bi-arrow-clockwise"></i> Generate New
                  </button>
                </div>
                <div class="row g-3">
                  <div class="col-12 col-md-6">
                    <div class="card">
                      <div class="card-header">User QR Code</div>
                      <div class="card-body text-center">
                        <div id="userQrCode" class="mb-3"></div>
                        <p class="text-muted small">{{ user_qr }}</p>
                        <button
                          class="btn btn-primary btn-print-qr"
                          data-qr-type="user"
                          data-qr-value="{{ user_qr }}"
                        >
                          <i class="bi bi-printer"></i> Print
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="col-12 col-md-6">
                    <div class="card">
                      <div class="card-header">Trainer QR Code</div>
                      <div class="card-body text-center">
                        <div id="trainerQrCode" class="mb-3"></div>
                        <p class="text-muted small">{{ trainer_qr }}</p>
                        <button
                          class="btn btn-primary btn-print-qr"
                          data-qr-type="trainer"
                          data-qr-value="{{ trainer_qr }}"
                        >
                          <i class="bi bi-printer"></i> Print
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Checked-in Users Tab -->
              <div
                class="tab-pane fade content-section"
                id="checkedin"
                role="tabpanel"
              >
                <div
                  class="d-flex justify-content-between align-items-center mb-3"
                >
                  <h3 class="h4">Currently Checked-in Users</h3>
                  <button class="btn btn-primary" id="refreshCheckedInBtn">
                    <i class="bi bi-arrow-clockwise"></i> Refresh
                  </button>
                </div>
                <div class="card">
                  <div class="card-body">
                    <div id="checkedInUsersList">
                      <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                          <span class="visually-hidden">Loading...</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Attendance Records Tab -->
              <div
                class="tab-pane fade content-section"
                id="attendance"
                role="tabpanel"
              >
                <div class="card">
                  <div class="card-header">
                    <i class="bi bi-calendar-check"></i> Attendance Records
                  </div>
                  <div class="card-body">
                    <div class="row mb-3">
                      <div class="col-md-4">
                        <label for="attendanceUsername" class="form-label"
                          >Username</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="attendanceUsername"
                          placeholder="Enter username (optional)"
                        />
                      </div>
                      <div class="col-md-3">
                        <label for="attendanceStartDate" class="form-label"
                          >Start Date</label
                        >
                        <input
                          type="date"
                          class="form-control"
                          id="attendanceStartDate"
                        />
                      </div>
                      <div class="col-md-3">
                        <label for="attendanceEndDate" class="form-label"
                          >End Date</label
                        >
                        <input
                          type="date"
                          class="form-control"
                          id="attendanceEndDate"
                        />
                      </div>
                      <div class="col-md-2 d-flex align-items-end">
                        <button
                          class="btn btn-primary w-100"
                          id="filterAttendanceBtn"
                        >
                          <i class="bi bi-funnel"></i> Filter
                        </button>
                      </div>
                    </div>

                    <div class="table-responsive">
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th>Username</th>
                            <th>Role</th>
                            <th>Action</th>
                            <th>Timestamp</th>
                            <th>Total Check-in Days</th>
                          </tr>
                        </thead>
                        <tbody id="attendanceRecordsList">
                          <tr>
                            <td colspan="5" class="text-center">
                              Use the filters above to search for attendance
                              records.
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Settings Tab -->
              <div
                class="tab-pane fade content-section"
                id="settings"
                role="tabpanel"
              >
                <h3 class="h4 mb-3">Settings</h3>
                <div class="card">
                  <div class="card-body">
                    <h5>Account Settings</h5>
                    <div class="mb-3">
                      <label for="adminName" class="form-label">Name</label>
                      <input
                        type="text"
                        class="form-control"
                        id="adminName"
                        value="{{ user.username }}"
                      />
                    </div>
                    <div class="mb-3">
                      <label for="adminEmail" class="form-label">Email</label>
                      <input
                        type="email"
                        class="form-control"
                        id="adminEmail"
                        value="{{ user.email }}"
                      />
                    </div>
                    <button class="btn btn-primary">Save Changes</button>
                  </div>
                </div>

                <div class="card mt-3">
                  <div class="card-body">
                    <h5>System Settings</h5>
                    <div class="mb-3 form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="emailNotifications"
                        checked
                      />
                      <label class="form-check-label" for="emailNotifications">
                        Email Notifications
                      </label>
                    </div>
                    <div class="mb-3 form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="autoApproveSubscriptions"
                      />
                      <label
                        class="form-check-label"
                        for="autoApproveSubscriptions"
                      >
                        Auto-approve Subscriptions
                      </label>
                    </div>
                    <button class="btn btn-primary">Save Settings</button>
                  </div>
                </div>

                <div class="card mt-3">
                  <div class="card-body">
                    <h5>Backup & Restore</h5>
                    <p class="text-muted">
                      Create a backup of your system data or restore from a
                      previous backup.
                    </p>
                    <button class="btn btn-outline-primary me-2">
                      Create Backup
                    </button>
                    <button class="btn btn-outline-secondary">
                      Restore Backup
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% else %}
        <!-- User/Trainer Dashboard -->
        <div class="row">
          <div class="col-12">
            <!-- Announcements Section -->
            <div class="content-section active" id="announcements">
              <div class="card">
                <div class="card-header">
                  <i class="bi bi-megaphone"></i> Announcements
                </div>
                <div class="card-body">
                  {% if blogs %} {% for blog in blogs %}
                  <div class="mb-4">
                    {% if blog.image_path %}
                    <img
                      src="{{ url_for('static', filename=blog.image_path.replace('static/', '')) }}"
                      alt="{{ blog.title }}"
                      class="img-fluid mb-3 rounded"
                      style="max-height: 300px; object-fit: cover; width: 100%"
                    />
                    {% endif %}
                    <h5>{{ blog.title }}</h5>
                    <p>{{ blog.content }}</p>
                    <small class="text-muted"
                      >Posted on: {{ blog.created_at }}</small
                    >
                    {% if not loop.last %}
                    <hr />
                    {% endif %}
                  </div>
                  {% endfor %} {% else %}
                  <p>No announcements available.</p>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Check-in/Check-out Section -->
            <div class="content-section" id="checkin">
              <div class="card">
                <div class="card-header">
                  <i class="bi bi-qr-code-scan"></i> Check-in / Check-out
                </div>
                <div class="card-body">
                  {% if check_logs %} {% if check_logs[0].check_type == 'in' %}
                  <div class="check-status checked-in">
                    <i class="bi bi-check-circle-fill"></i> Currently Checked In
                  </div>
                  {% else %}
                  <div class="check-status checked-out">
                    <i class="bi bi-x-circle-fill"></i> Currently Checked Out
                  </div>
                  {% endif %} {% else %}
                  <div class="check-status checked-out">
                    <i class="bi bi-x-circle-fill"></i> Currently Checked Out
                  </div>
                  {% endif %}

                  <button
                    class="btn btn-primary check-in-out-btn w-100"
                    id="startQRScannerBtn"
                  >
                    <i class="bi bi-qr-code-scan"></i> Scan QR Code
                  </button>

                  <div
                    id="qr-reader"
                    class="qr-scanner mt-3"
                    style="display: none"
                  ></div>

                  <div class="mt-4">
                    <h6>Recent Activity:</h6>
                    {% if check_logs %}
                    <div class="list-group">
                      {% for log in check_logs %}
                      <div
                        class="list-group-item d-flex justify-content-between align-items-center"
                      >
                        <span>
                          <i
                            class="bi bi-{{ 'box-arrow-in-right text-success' if log.check_type == 'in' else 'box-arrow-right text-danger' }}"
                          ></i>
                          Check-{{ log.check_type }}
                        </span>
                        <small class="text-muted">{{ log.timestamp }}</small>
                      </div>
                      {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-muted">No check-in/out history yet.</p>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>

            <!-- Messages Section -->
            <div class="content-section" id="messages">
              <div class="card">
                <div
                  class="card-header d-flex justify-content-between align-items-center"
                >
                  <span><i class="bi bi-envelope"></i> Messages</span>
                  <button
                    class="btn btn-sm btn-primary"
                    data-bs-toggle="modal"
                    data-bs-target="#sendMessageModal"
                  >
                    <i class="bi bi-plus-circle"></i> Send Message
                  </button>
                </div>
                <div class="card-body">
                  {% if messages %} {% for message in messages %}
                  <div class="card mb-3">
                    <div class="card-body">
                      <h6 class="card-title">{{ message.subject }}</h6>
                      <p class="card-text">{{ message.message }}</p>
                      <small class="text-muted"
                        >Sent on: {{ message.created_at }}</small
                      >

                      {% if message.reply %}
                      <div class="mt-3 p-3 bg-light rounded">
                        <h6>Reply:</h6>
                        <p class="mb-1">{{ message.reply }}</p>
                        <small class="text-muted"
                          >Replied on: {{ message.replied_at }}</small
                        >
                      </div>
                      {% endif %}
                    </div>
                  </div>
                  {% endfor %} {% else %}
                  <p>No messages sent yet.</p>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Subscription Section -->
            <div class="content-section" id="subscription">
              <!-- Monthly Subscription -->
              <div class="card mb-3">
                <div class="card-header">
                  <i class="bi bi-calendar-month"></i> Monthly Subscription
                </div>
                <div class="card-body">
                  {% if monthly_subscription %} {% if is_monthly_expired %}
                  <div class="subscription-status expired-subscription">
                    <i class="bi bi-x-circle-fill"></i> Expired
                  </div>
                  <p>
                    <strong>Plan:</strong> {{ monthly_subscription.months }}
                    Month(s)
                  </p>
                  <p>
                    <strong>Status:</strong> Expired on {{
                    monthly_subscription.expires_at }}
                  </p>
                  <p class="text-muted small">
                    Your monthly subscription has expired. Please contact admin
                    to renew.
                  </p>
                  {% else %}
                  <div class="subscription-status active-subscription">
                    <i class="bi bi-check-circle-fill"></i> Active
                  </div>
                  <p>
                    <strong>Plan:</strong> {{ monthly_subscription.months }}
                    Month(s)
                  </p>
                  <p>
                    <strong>Activated:</strong> {{
                    monthly_subscription.activated_at }}
                  </p>
                  <p>
                    <strong>Expires:</strong> {{ monthly_subscription.expires_at
                    }}
                  </p>
                  {% endif %} {% else %}
                  <div class="subscription-status no-subscription">
                    <i class="bi bi-x-circle-fill"></i> No Active Subscription
                  </div>
                  <p class="text-muted small">
                    You don't have an active monthly subscription. Please
                    contact admin to subscribe.
                  </p>
                  {% endif %}
                </div>
              </div>
            </div>
            <!-- Settings Section -->
            <div class="content-section" id="settings">
              <div class="card">
                <div class="card-header">
                  <i class="bi bi-gear"></i> Settings
                </div>
                <div class="card-body">
                  <h5>Account Settings</h5>
                  <div class="mb-3">
                    <label for="userName" class="form-label">Username</label>
                    <input
                      type="text"
                      class="form-control"
                      id="userName"
                      value="{{ user.username }}"
                      readonly
                    />
                  </div>
                  <div class="mb-3">
                    <label for="userEmail" class="form-label">Email</label>
                    <input
                      type="email"
                      class="form-control"
                      id="userEmail"
                      value="{{ user.email }}"
                      readonly
                    />
                  </div>
                  <div class="mb-3">
                    <label for="userRole" class="form-label">Role</label>
                    <input
                      type="text"
                      class="form-control"
                      id="userRole"
                      value="{{ role }}"
                      readonly
                    />
                  </div>

                  <hr class="my-4" />

                  <h5>App Settings</h5>
                  <div class="mb-3 form-check form-switch">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="pushNotifications"
                      checked
                    />
                    <label class="form-check-label" for="pushNotifications">
                      Push Notifications
                    </label>
                  </div>
                  <div class="mb-3 form-check form-switch">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="emailNotifications"
                      checked
                    />
                    <label class="form-check-label" for="emailNotifications">
                      Email Notifications
                    </label>
                  </div>
                  <button class="btn btn-primary">Save Settings</button>
                  <hr class="my-4" />

                  <a href="/logout" class="btn btn-danger w-100">
                    <i class="bi bi-box-arrow-right"></i> Logout
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Modals -->
    <!-- Create User Modal -->
    <div class="modal fade" id="createUserModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Create New User</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="createUserForm">
              <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input
                  type="text"
                  class="form-control"
                  id="username"
                  name="username"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input
                  type="password"
                  class="form-control"
                  id="password"
                  name="password"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  name="email"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="role" class="form-label">Role</label>
                <select class="form-select" id="role" name="role" required>
                  <option value="user">User</option>
                  <option value="trainer">Trainer</option>
                  <option value="admin">Admin</option>
                </select>
              </div>
              <div class="mb-3 form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="approved"
                  name="approved"
                  checked
                />
                <label class="form-check-label" for="approved">Active</label>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-primary" id="createUserBtn">
              Create User
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal fade" id="editUserModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit User</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="editUserForm">
              <input type="hidden" id="editUserId" name="user_id" />
              <div class="mb-3">
                <label for="editUsername" class="form-label">Username</label>
                <input
                  type="text"
                  class="form-control"
                  id="editUsername"
                  name="username"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="editPassword" class="form-label"
                  >Password (leave blank to keep current)</label
                >
                <input
                  type="password"
                  class="form-control"
                  id="editPassword"
                  name="password"
                />
              </div>
              <div class="mb-3">
                <label for="editEmail" class="form-label">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="editEmail"
                  name="email"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="editRole" class="form-label">Role</label>
                <select class="form-select" id="editRole" name="role" required>
                  <option value="user">User</option>
                  <option value="trainer">Trainer</option>
                  <option value="admin">Admin</option>
                </select>
              </div>
              <div class="mb-3 form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="editApproved"
                  name="approved"
                />
                <label class="form-check-label" for="editApproved"
                  >Active</label
                >
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-primary" id="updateUserBtn">
              Update User
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Create Blog Modal -->
    <div class="modal fade" id="createBlogModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Create New Blog</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="createBlogForm" enctype="multipart/form-data">
              <div class="mb-3">
                <label for="blogTitle" class="form-label">Title</label>
                <input
                  type="text"
                  class="form-control"
                  id="blogTitle"
                  name="title"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="blogImage" class="form-label"
                  >Blog Image (1200x627 pixels)</label
                >
                <input
                  type="file"
                  class="form-control"
                  id="blogImage"
                  name="image"
                  accept="image/*"
                />
                <div class="form-text">
                  Recommended size: 1200x627 pixels. Image will be automatically
                  resized.
                </div>
                <div id="imagePreview" class="mt-2"></div>
              </div>
              <div class="mb-3">
                <label for="blogContent" class="form-label">Content</label>
                <textarea
                  class="form-control"
                  id="blogContent"
                  name="content"
                  rows="5"
                  required
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-primary" id="createBlogBtn">
              Create Blog
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Blog Modal -->
    <div class="modal fade" id="editBlogModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit Blog</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="editBlogForm" enctype="multipart/form-data">
              <input type="hidden" id="editBlogId" name="blog_id" />
              <div class="mb-3">
                <label for="editBlogTitle" class="form-label">Title</label>
                <input
                  type="text"
                  class="form-control"
                  id="editBlogTitle"
                  name="title"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="editBlogImage" class="form-label"
                  >Blog Image (1200x627 pixels)</label
                >
                <input
                  type="file"
                  class="form-control"
                  id="editBlogImage"
                  name="image"
                  accept="image/*"
                />
                <div class="form-text">
                  Recommended size: 1200x627 pixels. Image will be automatically
                  resized.
                </div>
                <div id="editImagePreview" class="mt-2"></div>
              </div>
              <div class="mb-3">
                <label for="editBlogContent" class="form-label">Content</label>
                <textarea
                  class="form-control"
                  id="editBlogContent"
                  name="content"
                  rows="5"
                  required
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-primary" id="updateBlogBtn">
              Update Blog
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Create Subscription Modal -->
    <div class="modal fade" id="createSubscriptionModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add Subscription</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="createSubscriptionForm">
              <div class="mb-3">
                <label for="subscriptionUser" class="form-label">User</label>
                <select
                  class="form-select"
                  id="subscriptionUser"
                  name="user_id"
                  required
                >
                  <option value="">Select User</option>
                  {% for user in users %} {% if user.role != 'admin' %}
                  <option value="{{ user.id }}">
                    {{ user.username }} ({{ user.email }})
                  </option>
                  {% endif %} {% endfor %}
                </select>
              </div>

              <div class="mb-3">
                <label for="subscriptionType" class="form-label"
                  >Subscription Type</label
                >
                <select
                  class="form-select"
                  id="subscriptionType"
                  name="subscription_type"
                  required
                >
                  <option value="">Select Type</option>
                  <option value="monthly">Monthly Subscription</option>
                </select>
              </div>

              <!-- Monthly Subscription Options -->
              <div
                id="monthlyOptions"
                class="subscription-options"
                style="display: none"
              >
                <div class="mb-3">
                  <label for="subscriptionMonths" class="form-label"
                    >Number of Months</label
                  >
                  <select
                    class="form-select"
                    id="subscriptionMonths"
                    name="months"
                  >
                    <option value="1">1 Month</option>
                    <option value="2">2 Months</option>
                    <option value="3">3 Months</option>
                    <option value="6">6 Months</option>
                    <option value="12">12 Months</option>
                  </select>
                </div>
                <div class="alert alert-info">
                  <i class="bi bi-info-circle"></i> Price:
                  <span id="monthlyPriceDisplay">{{ monthly_price }}</span> MMK
                  per month
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="createSubscriptionBtn"
            >
              Add Subscription
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Send Message Modal -->
    <div class="modal fade" id="sendMessageModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Send Message</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="sendMessageForm">
              <div class="mb-3">
                <label for="messageSubject" class="form-label">Subject</label>
                <input
                  type="text"
                  class="form-control"
                  id="messageSubject"
                  name="subject"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="messageContent" class="form-label">Message</label>
                <textarea
                  class="form-control"
                  id="messageContent"
                  name="message"
                  rows="5"
                  required
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-primary" id="sendMessageBtn">
              Send Message
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Refresh Button -->
    <button class="btn btn-primary refresh-btn" onclick="location.reload()">
      <i class="bi bi-arrow-clockwise"></i>
    </button>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Define server-side variables as JS variables to avoid editor errors
        const userRole = "{{ role }}";
        const userQrValue = "{{ user_qr }}";
        const trainerQrValue = "{{ trainer_qr }}";

        // Mobile Top Bar Title Update
        const mobileTopBarTitle = document.getElementById("mobileTopBarTitle");

        // Bottom Navigation
        document
          .querySelectorAll(".bottom-nav-item[data-tab]")
          .forEach((item) => {
            item.addEventListener("click", function (e) {
              e.preventDefault();
              const tabName = this.dataset.tab;

              // Hide all sections
              document
                .querySelectorAll(".content-section")
                .forEach((section) => {
                  section.classList.remove("active");
                });

              // Show selected section
              const targetSection = document.getElementById(tabName);
              if (targetSection) {
                targetSection.classList.add("active");
              }

              // Update active states
              document
                .querySelectorAll(".bottom-nav-item")
                .forEach((navItem) => {
                  navItem.classList.remove("active");
                });
              this.classList.add("active");

              // Update mobile top bar title
              if (mobileTopBarTitle) {
                const titleText = this.querySelector("span").textContent;
                mobileTopBarTitle.textContent = titleText;
              }

              // Load checked-in users if that tab is selected
              if (tabName === "checkedin" && userRole === "admin") {
                loadCheckedInUsers();
              }
            });
          });

        // Generate QR codes for admin
        if (userRole === "admin" && typeof QRCode !== "undefined") {
          new QRCode(document.getElementById("userQrCode"), {
            text: userQrValue,
            width: 200,
            height: 200,
          });
          new QRCode(document.getElementById("trainerQrCode"), {
            text: trainerQrValue,
            width: 200,
            height: 200,
          });
        }

        // QR Scanner
        const startQRScannerBtn = document.getElementById("startQRScannerBtn");
        if (startQRScannerBtn) {
          startQRScannerBtn.addEventListener("click", startQRScanner);
        }

        function startQRScanner() {
          const qrReader = document.getElementById("qr-reader");
          qrReader.style.display = "block";

          const html5QrCode = new Html5Qrcode(qrReader.id);

          Html5Qrcode.getCameras()
            .then((devices) => {
              if (devices && devices.length) {
                const cameraId = devices[0].id;
                html5QrCode
                  .start(
                    cameraId,
                    { fps: 10, qrbox: { width: 250, height: 250 } },
                    (decodedText) => {
                      html5QrCode
                        .stop()
                        .then(() => {
                          qrReader.style.display = "none";
                          fetch("/check-in-out", {
                            method: "POST",
                            headers: {
                              "Content-Type":
                                "application/x-www-form-urlencoded",
                            },
                            body: "qr_value=" + encodeURIComponent(decodedText),
                          })
                            .then((response) => response.json())
                            .then((data) => {
                              alert(data.message);
                              if (data.success) {
                                // Refresh the checked-in users list if admin
                                if (userRole === "admin") {
                                  loadCheckedInUsers();
                                }
                                // Also update the user's own check-in status
                                location.reload();
                              }
                            })
                            .catch((error) => {
                              console.error("Error:", error);
                              alert("An error occurred during check-in/out");
                            });
                        })
                        .catch((err) =>
                          console.error(`Unable to stop scanning: ${err}`)
                        );
                    },
                    () => {} // Silently ignore scan errors
                  )
                  .catch((err) => {
                    console.error(`Unable to start scanning: ${err}`);
                    alert("Unable to access camera. Please check permissions.");
                  });
              }
            })
            .catch((err) => {
              console.error(`Unable to get cameras: ${err}`);
              alert("Unable to access camera. Please check permissions.");
            });
        }

        // Image preview functions
        function previewImage(input, previewContainer) {
          if (input.files && input.files[0]) {
            const reader = new FileReader();

            reader.onload = function (e) {
              previewContainer.innerHTML = `
                <img src="${e.target.result}" alt="Preview" class="img-thumbnail mt-2" style="max-width: 100%; max-height: 300px;">
                <div class="form-text mt-1">Image preview (will be resized to 1200x627 pixels)</div>
              `;
            };

            reader.readAsDataURL(input.files[0]);
          } else {
            previewContainer.innerHTML = "";
          }
        }

        // Add event listeners for image preview
        const blogImageInput = document.getElementById("blogImage");
        if (blogImageInput) {
          blogImageInput.addEventListener("change", function () {
            previewImage(this, document.getElementById("imagePreview"));
          });
        }

        const editBlogImageInput = document.getElementById("editBlogImage");
        if (editBlogImageInput) {
          editBlogImageInput.addEventListener("change", function () {
            previewImage(this, document.getElementById("editImagePreview"));
          });
        }

        // Load checked-in users (only for admin)
        function loadCheckedInUsers() {
          if (userRole === "admin") {
            fetch("/get-checked-in-users")
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  const container =
                    document.getElementById("checkedInUsersList");

                  if (data.users.length === 0) {
                    container.innerHTML =
                      '<p class="text-muted text-center">No users are currently checked in.</p>';
                  } else {
                    let html =
                      '<div class="table-responsive"><table class="table"><thead><tr><th>User</th><th>Role</th><th>Check-in Time</th></tr></thead><tbody>';

                    data.users.forEach((user) => {
                      const roleIcon =
                        user.role === "trainer"
                          ? '<i class="bi bi-person-badge"></i>'
                          : '<i class="bi bi-person"></i>';
                      const checkInTime = new Date(
                        user.check_in_time
                      ).toLocaleString();

                      html += `
                        <tr>
                          <td>${roleIcon} ${user.username}</td>
                          <td><span class="badge bg-${
                            user.role === "trainer" ? "info" : "secondary"
                          }">${user.role}</span></td>
                          <td>${checkInTime}</td>
                        </tr>
                      `;
                    });

                    html += "</tbody></table></div>";
                    container.innerHTML = html;
                  }
                } else {
                  document.getElementById("checkedInUsersList").innerHTML =
                    '<p class="text-danger text-center">Error loading checked-in users.</p>';
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                document.getElementById("checkedInUsersList").innerHTML =
                  '<p class="text-danger text-center">Error loading checked-in users.</p>';
              });
          }
        }

        // Only set up event listeners if we're on admin page
        if (userRole === "admin") {
          // Load checked-in users when checked-in tab is shown
          const checkedinTab = document.getElementById("checkedin-tab");
          if (checkedinTab) {
            checkedinTab.addEventListener("shown.bs.tab", function () {
              loadCheckedInUsers();
            });
          }

          // Refresh button click handler
          const refreshBtn = document.getElementById("refreshCheckedInBtn");
          if (refreshBtn) {
            refreshBtn.addEventListener("click", loadCheckedInUsers);
          }

          // Auto-refresh every 30 seconds when on checked-in tab
          setInterval(function () {
            const checkedInTab = document.getElementById("checkedin-tab");
            if (checkedInTab && checkedInTab.classList.contains("active")) {
              loadCheckedInUsers();
            }
          }, 30000);
        }

        // User Management Functions
        const createUserBtn = document.getElementById("createUserBtn");
        if (createUserBtn) {
          createUserBtn.addEventListener("click", function () {
            const form = document.getElementById("createUserForm");
            const formData = new FormData(form);
            const isActive = formData.get("approved") ? 0 : 1;
            const data = new URLSearchParams({
              username: formData.get("username"),
              password: formData.get("password"),
              email: formData.get("email"),
              role: formData.get("role"),
              approved: isActive,
            });

            fetch("/create-user", { method: "POST", body: data })
              .then((response) => response.json())
              .then((data) => {
                alert(data.message);
                if (data.success) {
                  bootstrap.Modal.getInstance(
                    document.getElementById("createUserModal")
                  ).hide();
                  location.reload();
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("An error occurred while creating user");
              });
          });
        }

        // Edit User
        document.querySelectorAll(".btn-edit-user").forEach((button) => {
          button.addEventListener("click", function () {
            const userId = this.dataset.userId;
            const username = this.dataset.username;
            const email = this.dataset.email;
            const role = this.dataset.role;
            const isActive = this.dataset.approved == "0";

            document.getElementById("editUserId").value = userId;
            document.getElementById("editUsername").value = username;
            document.getElementById("editEmail").value = email;
            document.getElementById("editRole").value = role;
            document.getElementById("editApproved").checked = isActive;

            new bootstrap.Modal(
              document.getElementById("editUserModal")
            ).show();
          });
        });

        const updateUserBtn = document.getElementById("updateUserBtn");
        if (updateUserBtn) {
          updateUserBtn.addEventListener("click", function () {
            const form = document.getElementById("editUserForm");
            const formData = new FormData(form);
            const userId = document.getElementById("editUserId").value;
            const isActive = formData.get("approved") ? 0 : 1;
            const data = new URLSearchParams({
              user_id: formData.get("user_id"),
              username: formData.get("username"),
              password: formData.get("password"),
              email: formData.get("email"),
              role: formData.get("role"),
              approved: isActive,
            });

            fetch("/edit-user", {
              method: "POST",
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body: data,
            })
              .then((response) => response.json())
              .then((data) => {
                alert(data.message);
                if (data.success) {
                  bootstrap.Modal.getInstance(
                    document.getElementById("editUserModal")
                  ).hide();
                  location.reload();
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("An error occurred while updating user");
              });
          });
        }

        // Ban/Unban functionality
        document.addEventListener("click", function (e) {
          if (e.target.closest(".btn-toggle-ban")) {
            e.preventDefault();
            const button = e.target.closest(".btn-toggle-ban");
            const userId = button.dataset.userId;
            const username = button.dataset.username;

            const action = button.textContent.trim().toLowerCase();
            const confirmationMessage = `Are you sure you want to ${action} ${username}?`;

            if (confirm(confirmationMessage)) {
              fetch("/toggle-ban-user", {
                method: "POST",
                headers: {
                  "Content-Type": "application/x-www-form-urlencoded",
                },
                body: `user_id=${encodeURIComponent(userId)}`,
              })
                .then((response) => response.json())
                .then((data) => {
                  alert(data.message);
                  if (data.success) {
                    location.reload();
                  }
                })
                .catch((error) => {
                  console.error("Error:", error);
                  alert(
                    `An error occurred while trying to ${action} the user.`
                  );
                });
            }
          }
        });

        // Delete User
        document.querySelectorAll(".btn-delete-user").forEach((button) => {
          button.addEventListener("click", function () {
            if (confirm("Are you sure you want to delete this user?")) {
              const userId = this.dataset.userId;
              fetch("/delete-user", {
                method: "POST",
                headers: {
                  "Content-Type": "application/x-www-form-urlencoded",
                },
                body: `user_id=${encodeURIComponent(userId)}`,
              })
                .then((response) => response.json())
                .then((data) => {
                  alert(data.message);
                  if (data.success) location.reload();
                })
                .catch((error) => {
                  console.error("Error:", error);
                  alert("An error occurred while deleting user");
                });
            }
          });
        });

        // Send message to admin
        const sendMessageBtn = document.getElementById("sendMessageBtn");
        if (sendMessageBtn) {
          sendMessageBtn.addEventListener("click", function () {
            const form = document.getElementById("sendMessageForm");
            const formData = new FormData(form);
            const data = new URLSearchParams(formData);

            fetch("/send-message", {
              method: "POST",
              body: data,
            })
              .then((response) => response.json())
              .then((data) => {
                alert(data.message);
                if (data.success) {
                  bootstrap.Modal.getInstance(
                    document.getElementById("sendMessageModal")
                  ).hide();
                  location.reload();
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("An error occurred while sending message");
              });
          });
        }

        // Subscription Type Selection
        const subscriptionTypeSelect =
          document.getElementById("subscriptionType");
        if (subscriptionTypeSelect) {
          subscriptionTypeSelect.addEventListener("change", function () {
            const monthlyOptions = document.getElementById("monthlyOptions");

            // Hide all options
            monthlyOptions.style.display = "none";

            // Show selected option
            if (this.value === "monthly") {
              monthlyOptions.style.display = "block";
            }
          });
        }

        // Create Subscription
        const createSubscriptionBtn = document.getElementById(
          "createSubscriptionBtn"
        );
        if (createSubscriptionBtn) {
          createSubscriptionBtn.addEventListener("click", function () {
            const form = document.getElementById("createSubscriptionForm");
            const formData = new FormData(form);
            const data = new URLSearchParams(formData);

            fetch("/create-user-subscription", { method: "POST", body: data })
              .then((response) => response.json())
              .then((data) => {
                alert(data.message);
                if (data.success) {
                  bootstrap.Modal.getInstance(
                    document.getElementById("createSubscriptionModal")
                  ).hide();
                  location.reload();
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("An error occurred while creating subscription");
              });
          });
        }

        // Update Monthly Price
        const updateMonthlyPriceBtn = document.getElementById(
          "updateMonthlyPriceBtn"
        );
        if (updateMonthlyPriceBtn) {
          updateMonthlyPriceBtn.addEventListener("click", function () {
            const price = document.getElementById("newMonthlyPrice").value;

            if (!price) {
              alert("Please enter a valid price");
              return;
            }

            const data = new URLSearchParams({ price: price });

            fetch("/update-monthly-price", { method: "POST", body: data })
              .then((response) => response.json())
              .then((data) => {
                alert(data.message);
                if (data.success) {
                  location.reload();
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("An error occurred while updating price");
              });
          });
        }

        // Generate new QR codes
        const generateNewQrBtn = document.getElementById("generateNewQrBtn");
        if (generateNewQrBtn) {
          generateNewQrBtn.addEventListener("click", function () {
            fetch("/generate-qr-codes")
              .then((response) => response.text())
              .then((html) => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, "text/html");
                const newUserQr = doc.querySelector('[data-qr-type="user"]')
                  .dataset.qrValue;
                const newTrainerQr = doc.querySelector(
                  '[data-qr-type="trainer"]'
                ).dataset.qrValue;

                document.getElementById("userQrCode").innerHTML = "";
                document.getElementById("trainerQrCode").innerHTML = "";

                new QRCode(document.getElementById("userQrCode"), {
                  text: newUserQr,
                  width: 200,
                  height: 200,
                });
                new QRCode(document.getElementById("trainerQrCode"), {
                  text: newTrainerQr,
                  width: 200,
                  height: 200,
                });

                document.querySelector(
                  '[data-qr-type="user"]'
                ).dataset.qrValue = newUserQr;
                document.querySelector(
                  '[data-qr-type="trainer"]'
                ).dataset.qrValue = newTrainerQr;
                document
                  .querySelector('[data-qr-type="user"]')
                  .parentElement.querySelector(".text-muted").textContent =
                  newUserQr;
                document
                  .querySelector('[data-qr-type="trainer"]')
                  .parentElement.querySelector(".text-muted").textContent =
                  newTrainerQr;

                alert("QR codes generated successfully!");
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("An error occurred while generating QR codes");
              });
          });
        }

        // Reply to Messages
        document.addEventListener("click", function (e) {
          if (e.target.closest(".btn-reply-message")) {
            e.preventDefault();
            const button = e.target.closest(".btn-reply-message");
            const messageId = button.dataset.messageId;
            const replyText = document.querySelector(
              `#replyText${messageId}`
            ).value;

            if (!replyText) {
              alert("Please enter a reply");
              return;
            }

            fetch("/reply-message", {
              method: "POST",
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body: `message_id=${encodeURIComponent(
                messageId
              )}&reply=${encodeURIComponent(replyText)}`,
            })
              .then((response) => {
                if (!response.ok) {
                  throw new Error("Network response was not ok");
                }
                return response.json();
              })
              .then((data) => {
                console.log("Response:", data);
                alert(data.message);
                if (data.success) location.reload();
              })
              .catch((error) => {
                console.error("Error:", error);
                alert(
                  "An error occurred while replying to the message: " +
                    error.message
                );
              });
          }
        });

        // Blog Functions
        const createBlogBtn = document.getElementById("createBlogBtn");
        if (createBlogBtn) {
          createBlogBtn.addEventListener("click", function () {
            const form = document.getElementById("createBlogForm");
            const formData = new FormData(form);

            fetch("/create-blog", { method: "POST", body: formData })
              .then((response) => response.json())
              .then((data) => {
                alert(data.message);
                if (data.success) {
                  bootstrap.Modal.getInstance(
                    document.getElementById("createBlogModal")
                  ).hide();
                  location.reload();
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("An error occurred while creating blog");
              });
          });
        }

        // Edit Blog
        document.querySelectorAll(".btn-edit-blog").forEach((button) => {
          button.addEventListener("click", function () {
            const blogId = this.dataset.blogId;
            const title = this.dataset.title;
            const content = this.dataset.content;
            const imagePath = this.dataset.imagePath;

            document.getElementById("editBlogId").value = blogId;
            document.getElementById("editBlogTitle").value = title;
            document.getElementById("editBlogContent").value = content;

            // Show current image if it exists
            const editImagePreview =
              document.getElementById("editImagePreview");
            if (imagePath) {
              editImagePreview.innerHTML = `
                <img src="/${imagePath}" alt="Current image" class="img-thumbnail mt-2" style="max-width: 100%; max-height: 300px;">
                <div class="form-text mt-1">Current image. Upload a new one to replace.</div>
              `;
            } else {
              editImagePreview.innerHTML = "";
            }

            new bootstrap.Modal(
              document.getElementById("editBlogModal")
            ).show();
          });
        });

        const updateBlogBtn = document.getElementById("updateBlogBtn");
        if (updateBlogBtn) {
          updateBlogBtn.addEventListener("click", function () {
            const form = document.getElementById("editBlogForm");
            const formData = new FormData(form);

            fetch("/edit-blog", { method: "POST", body: formData })
              .then((response) => response.json())
              .then((data) => {
                alert(data.message);
                if (data.success) {
                  bootstrap.Modal.getInstance(
                    document.getElementById("editBlogModal")
                  ).hide();
                  location.reload();
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("An error occurred while updating blog");
              });
          });
        }

        // Delete Blog
        document.querySelectorAll(".btn-delete-blog").forEach((button) => {
          button.addEventListener("click", function () {
            if (confirm("Are you sure you want to delete this blog?")) {
              const blogId = this.dataset.blogId;
              fetch("/delete-blog", {
                method: "POST",
                body: `blog_id=${encodeURIComponent(blogId)}`,
              })
                .then((response) => response.json())
                .then((data) => {
                  alert(data.message);
                  if (data.success) location.reload();
                })
                .catch((error) => {
                  console.error("Error:", error);
                  alert("An error occurred while deleting blog");
                });
            }
          });
        });

        // Print QR Code
        document.querySelectorAll(".btn-print-qr").forEach((button) => {
          button.addEventListener("click", function () {
            const type = this.dataset.qrType;
            const value = this.dataset.qrValue;
            const title =
              type === "user"
                ? "User Check-in QR Code"
                : "Trainer Check-in QR Code";

            const printWindow = window.open("", "_blank");
            const html =
              "" +
              "<html>" +
              "<head>" +
              "<title>" +
              title +
              "</title>" +
              "<style>" +
              "body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }" +
              "h1 { margin-bottom: 20px; }" +
              "#qrcode { margin: 20px auto; width: 300px; height: 300px; }" +
              ".code-value { font-size: 24px; font-weight: bold; margin-top: 20px; }" +
              "</style>" +
              "</head>" +
              "<body>" +
              "<h1>" +
              title +
              "</h1>" +
              '<div id="qrcode"></div>' +
              '<div class="code-value">' +
              value +
              "</div>" +
              '<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></' +
              "script>" +
              "<script>" +
              'new QRCode(document.getElementById("qrcode"), { text: "' +
              value +
              '", width: 300, height: 300 });' +
              "window.onload = function() { window.print(); };" +
              "</" +
              "script>" +
              "</body>" +
              "</html>";
            printWindow.document.write(html);
            printWindow.document.close();
          });
        });
        // Filter Attendance Records
        const filterAttendanceBtn = document.getElementById(
          "filterAttendanceBtn"
        );
        if (filterAttendanceBtn) {
          filterAttendanceBtn.addEventListener("click", function () {
            const username =
              document.getElementById("attendanceUsername").value;
            const startDate = document.getElementById(
              "attendanceStartDate"
            ).value;
            const endDate = document.getElementById("attendanceEndDate").value;

            const data = new URLSearchParams({
              username: username,
              start_date: startDate,
              end_date: endDate,
            });

            fetch("/get-attendance-records", {
              method: "POST",
              headers: {
                "Content-Type": "application/x-www-form-urlencoded",
              },
              body: data,
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  const recordsList = document.getElementById(
                    "attendanceRecordsList"
                  );

                  if (data.records.length === 0) {
                    recordsList.innerHTML = `
            <tr>
              <td colspan="5" class="text-center">
                No attendance records found matching the criteria.
              </td>
            </tr>
          `;
                  } else {
                    let html = "";
                    data.records.forEach((record) => {
                      const actionIcon =
                        record.check_type === "in"
                          ? '<i class="bi bi-box-arrow-in-right text-success"></i>'
                          : '<i class="bi bi-box-arrow-right text-danger"></i>';
                      const actionText =
                        record.check_type === "in" ? "Check-in" : "Check-out";
                      const timestamp = new Date(
                        record.timestamp
                      ).toLocaleString();

                      html += `
                        <tr>
                          <td>${record.username}</td>
                          <td><span class="badge bg-${
                            record.role === "trainer" ? "info" : "secondary"
                          }">${record.role}</span></td>
                          <td>${actionIcon} ${actionText}</td>
                          <td>${timestamp}</td>
                          <td><span class="badge bg-primary">${
                            record.checkin_days
                          } days</span></td>
                        </tr>
                      `;
                    });
                    recordsList.innerHTML = html;
                  }
                } else {
                  alert(data.message);
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("An error occurred while fetching attendance records");
              });
          });
        }
      });
    </script>
  </body>
</html>
